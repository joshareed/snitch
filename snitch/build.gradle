apply plugin: 'java'
//apply plugin: 'groovy'
apply plugin: 'eclipse'

sourceCompatibility = 1.6
targetCompatibility = 1.6
groovyVersion = '1.8.5'

version = '0.0.1-SNAPSHOT'
group = 'com.refactr.snitch'

manifest.mainAttributes(
	'Implementation-Title': 'Snitch Code Metrics',
	'Implementation-Version': version,
	'Main-Class': 'com.refactr.snitch.SnitchEngine'
)

repositories {
	mavenCentral()
	flatDir(dirs: 'lib')
}

dependencies {
	//groovy group: 'org.codehaus.groovy', name: 'groovy-all', version: groovyVersion
	testCompile group: 'junit', name: 'junit', version: '4.10'
}

task release(dependsOn: configurations.default.allArtifacts.buildDependencies) << {
	def dest = file("$buildDir/fatjar")
	dest.mkdirs()

	// expand all our dependencies
	configurations.compile.each { jar ->
		ant.unzip(src: jar, dest: dest, overwrite: true)
	}

	// expand our code
	configurations.default.allArtifacts.files.each { jar ->
		ant.unzip(src: jar, dest: dest, overwrite: true)
	}

	// create our fatjar
	mkdir("$buildDir/release")
	ant.zip(destfile: "$buildDir/release/snitch-all-${version}.jar", basedir: dest)
}
